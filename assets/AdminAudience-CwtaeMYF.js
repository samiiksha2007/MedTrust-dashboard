import{c,r as o,q,l as D,o as T,e as f,h as $,j as e,S as j,U as N,M as I,d as F,f as b}from"./index-kmRHtsms.js";const R=c("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),v=c("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),w=c("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),h=c("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),k=c("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),H=()=>{const[x,A]=o.useState([]),[l,C]=o.useState([]),[M,U]=o.useState(!0);o.useEffect(()=>{(async()=>{try{const a=(await F(f(b,"predictions"))).docs.map(i=>({id:i.id,...i.data()}));A(a)}catch(r){console.error("Error fetching predictions:",r)}finally{U(!1)}})();const t=q(f(b,"authEvents"),T("timestamp","desc"),D(50)),n=$(t,r=>{const a=r.docs.map(i=>({id:i.id,...i.data()}));C(a)},r=>{console.error("Error listening to auth events:",r)});return()=>n()},[]);const g=[...new Set(x.map(s=>s.userEmail))],E=g.length,P=x.reduce((s,t)=>{const n=t.country||"Unknown";return s[n]=(s[n]||0)+1,s},{}),d=Object.entries(P).map(([s,t])=>({country:s,count:t})).sort((s,t)=>t.count-s.count),L=l.reduce((s,t)=>{const n=t.country||"Unknown";return s[n]=(s[n]||0)+1,s},{}),m=Object.entries(L).map(([s,t])=>({country:s,count:t})).sort((s,t)=>t.count-s.count),S=g.map(s=>{const t=x.filter(a=>a.userEmail===s),n=t.reduce((a,i)=>{var y;if(!((y=i.timestamp)!=null&&y.seconds))return a;const p=i.timestamp.seconds;return p>a?p:a},0),r=[...new Set(t.map(a=>a.country||"Unknown"))];return{email:s,predictionCount:t.length,lastActive:n,countries:r}}).sort((s,t)=>t.lastActive-s.lastActive),u=s=>{if(!s)return"Never";const t=new Date(s*1e3),r=new Date-t,a=Math.floor(r/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;const i=Math.floor(a/60);return i<24?`${i}h ago`:t.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})};return M?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading audience data..."})]})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-1",children:"Audience & Authentication"}),e.jsx("p",{className:"text-gray-400",children:"Real-time user activity, authentication events, and geographic distribution."})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-indigo-500/10 border border-indigo-500/20 rounded-xl text-indigo-300 text-sm",children:[e.jsx(j,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"Read-only view â€” data can only be modified directly in Firebase."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 p-6",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center",children:e.jsx(N,{className:"w-5 h-5 text-indigo-400"})})}),e.jsx("p",{className:"text-2xl font-bold text-white",children:E}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total Users"})]}),e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 p-6",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-green-400"})})}),e.jsx("p",{className:"text-2xl font-bold text-white",children:d.length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Countries"})]}),e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 p-6",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/20 flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5 text-amber-400"})})}),e.jsx("p",{className:"text-2xl font-bold text-white",children:l.filter(s=>s.action==="login").length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total Logins"})]}),e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 p-6",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsx("div",{className:"w-10 h-10 rounded-xl bg-pink-500/20 flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-pink-400"})})}),e.jsx("p",{className:"text-2xl font-bold text-white",children:l.filter(s=>s.action==="signup").length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total Signups"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-green-400"}),"Users by Country (Predictions)"]}),d.length>0?e.jsx("div",{className:"space-y-3",children:d.map((s,t)=>{var a;const n=((a=d[0])==null?void 0:a.count)||1,r=(s.count/n*100).toFixed(0);return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-300 w-32 truncate",children:s.country}),e.jsx("div",{className:"flex-1 bg-gray-800 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-green-500 to-emerald-400 transition-all duration-500",style:{width:`${r}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-400 w-10 text-right",children:s.count})]},t)})}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No country data yet. Country tracking starts with new predictions."})]}),e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-indigo-400"}),"Logins by Country"]}),m.length>0?e.jsx("div",{className:"space-y-3",children:m.map((s,t)=>{var a;const n=((a=m[0])==null?void 0:a.count)||1,r=(s.count/n*100).toFixed(0);return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-300 w-32 truncate",children:s.country}),e.jsx("div",{className:"flex-1 bg-gray-800 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-indigo-500 to-purple-400 transition-all duration-500",style:{width:`${r}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-400 w-10 text-right",children:s.count})]},t)})}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No login data yet. Auth tracking starts with the next login."})]})]}),e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-amber-400"}),"Authentication Events",e.jsxs("span",{className:"ml-auto flex items-center gap-1.5 text-xs text-green-400 font-normal",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),"Live"]})]}),l.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-400 border-b border-gray-800",children:[e.jsx("th",{className:"text-left py-3 px-3 font-medium",children:"Action"}),e.jsx("th",{className:"text-left py-3 px-3 font-medium",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-3 font-medium",children:"Country"}),e.jsx("th",{className:"text-left py-3 px-3 font-medium",children:"Time"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800/50",children:l.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-gray-800/30 transition-colors",children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${s.action==="login"?"bg-blue-500/15 text-blue-400":"bg-green-500/15 text-green-400"}`,children:[s.action==="login"?e.jsx(w,{className:"w-3 h-3"}):e.jsx(k,{className:"w-3 h-3"}),s.action==="login"?"Login":"Signup"]})}),e.jsxs("td",{className:"py-3 px-3 text-gray-300 flex items-center gap-1.5",children:[e.jsx(I,{className:"w-3.5 h-3.5 text-gray-500"}),s.email]}),e.jsx("td",{className:"py-3 px-3 text-gray-300",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(h,{className:"w-3.5 h-3.5 text-gray-500"}),s.country||"Unknown"]})}),e.jsxs("td",{className:"py-3 px-3 text-gray-400 flex items-center gap-1.5",children:[e.jsx(R,{className:"w-3.5 h-3.5 text-gray-500"}),(t=s.timestamp)!=null&&t.seconds?u(s.timestamp.seconds):"Pending..."]})]},s.id)})})]})}):e.jsx("p",{className:"text-gray-500 text-sm text-center py-8",children:"No authentication events recorded yet. Events will appear here after the next login or signup."})]}),e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-indigo-400"}),"All Users"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-400 border-b border-gray-800",children:[e.jsx("th",{className:"text-left py-3 px-3 font-medium",children:"User"}),e.jsx("th",{className:"text-left py-3 px-3 font-medium",children:"Predictions"}),e.jsx("th",{className:"text-left py-3 px-3 font-medium",children:"Country"}),e.jsx("th",{className:"text-left py-3 px-3 font-medium",children:"Last Active"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800/50",children:S.map((s,t)=>e.jsxs("tr",{className:"hover:bg-gray-800/30 transition-colors",children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 font-bold text-sm",children:s.email.charAt(0).toUpperCase()}),e.jsx("span",{className:"text-gray-300",children:s.email})]})}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 bg-indigo-500/15 text-indigo-400 text-xs rounded-full font-medium",children:s.predictionCount})}),e.jsx("td",{className:"py-3 px-3 text-gray-300",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(h,{className:"w-3.5 h-3.5 text-gray-500"}),s.countries.join(", ")]})}),e.jsx("td",{className:"py-3 px-3 text-gray-400",children:u(s.lastActive)})]},t))})]})})]})]})};export{H as default};
